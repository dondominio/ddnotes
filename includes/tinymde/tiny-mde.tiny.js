!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyMDE={})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")(),a=function(e){try{return!!e()}catch(e){return!0}},u=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),o={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,l={f:s&&!o.call({1:2},1)?function(e){var t=s(this,e);return!!t&&t.enumerable}:o},c=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},p={}.toString,h=function(e){return p.call(e).slice(8,-1)},f="".split,g=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==h(e)?f.call(e,""):Object(e)}:Object,d=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return g(d(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},F=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},y={}.hasOwnProperty,M=function(e,t){return y.call(e,t)},T=i.document,D=m(T)&&m(T.createElement),E=function(e){return D?T.createElement(e):{}},b=!u&&!a((function(){return 7!=Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a})),C=Object.getOwnPropertyDescriptor,A={f:u?C:function(e,t){if(e=v(e),t=F(t,!0),b)try{return C(e,t)}catch(e){}if(M(e,t))return c(!l.f.call(e,t),e[t])}},k=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},x=Object.defineProperty,w={f:u?x:function(e,t,n){if(k(e),t=F(t,!0),k(n),b)try{return x(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},S=u?function(e,t,n){return w.f(e,t,c(1,n))}:function(e,t,n){return e[t]=n,e},$=function(e,t){try{S(i,e,t)}catch(n){i[e]=t}return t},O="__core-js_shared__",L=i[O]||$(O,{}),_=Function.toString;"function"!=typeof L.inspectSource&&(L.inspectSource=function(e){return _.call(e)});var B,N,I,P=L.inspectSource,R=i.WeakMap,j="function"==typeof R&&/native code/.test(P(R)),H=n((function(e){(e.exports=function(e,t){return L[e]||(L[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),U=0,q=Math.random(),z=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++U+q).toString(36)},Z=H("keys"),V=function(e){return Z[e]||(Z[e]=z(e))},K={},X=i.WeakMap;if(j){var W=new X,Y=W.get,G=W.has,J=W.set;B=function(e,t){return J.call(W,e,t),t},N=function(e){return Y.call(W,e)||{}},I=function(e){return G.call(W,e)}}else{var Q=V("state");K[Q]=!0,B=function(e,t){return S(e,Q,t),t},N=function(e){return M(e,Q)?e[Q]:{}},I=function(e){return M(e,Q)}}var ee,te,ne={set:B,get:N,has:I,enforce:function(e){return I(e)?N(e):B(e,{})},getterFor:function(e){return function(t){var n;if(!m(t)||(n=N(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},re=n((function(e){var t=ne.get,n=ne.enforce,r=String(String).split("String");(e.exports=function(e,t,a,u){var o=!!u&&!!u.unsafe,s=!!u&&!!u.enumerable,l=!!u&&!!u.noTargetGet;"function"==typeof a&&("string"!=typeof t||M(a,"name")||S(a,"name",t),n(a).source=r.join("string"==typeof t?t:"")),e!==i?(o?!l&&e[t]&&(s=!0):delete e[t],s?e[t]=a:S(e,t,a)):s?e[t]=a:$(t,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||P(this)}))})),ie=i,ae=function(e){return"function"==typeof e?e:void 0},ue=function(e,t){return arguments.length<2?ae(ie[e])||ae(i[e]):ie[e]&&ie[e][t]||i[e]&&i[e][t]},oe=Math.ceil,se=Math.floor,le=function(e){return isNaN(e=+e)?0:(e>0?se:oe)(e)},ce=Math.min,pe=function(e){return e>0?ce(le(e),9007199254740991):0},he=Math.max,fe=Math.min,ge=function(e,t){var n=le(e);return n<0?he(n+t,0):fe(n,t)},de=function(e){return function(t,n,r){var i,a=v(t),u=pe(a.length),o=ge(r,u);if(e&&n!=n){for(;u>o;)if((i=a[o++])!=i)return!0}else for(;u>o;o++)if((e||o in a)&&a[o]===n)return e||o||0;return!e&&-1}},ve={includes:de(!0),indexOf:de(!1)},me=ve.indexOf,Fe=function(e,t){var n,r=v(e),i=0,a=[];for(n in r)!M(K,n)&&M(r,n)&&a.push(n);for(;t.length>i;)M(r,n=t[i++])&&(~me(a,n)||a.push(n));return a},ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Me=ye.concat("length","prototype"),Te={f:Object.getOwnPropertyNames||function(e){return Fe(e,Me)}},De={f:Object.getOwnPropertySymbols},Ee=ue("Reflect","ownKeys")||function(e){var t=Te.f(k(e)),n=De.f;return n?t.concat(n(e)):t},be=function(e,t){for(var n=Ee(t),r=w.f,i=A.f,a=0;a<n.length;a++){var u=n[a];M(e,u)||r(e,u,i(t,u))}},Ce=/#|\.prototype\./,Ae=function(e,t){var n=xe[ke(e)];return n==Se||n!=we&&("function"==typeof t?a(t):!!t)},ke=Ae.normalize=function(e){return String(e).replace(Ce,".").toLowerCase()},xe=Ae.data={},we=Ae.NATIVE="N",Se=Ae.POLYFILL="P",$e=Ae,Oe=A.f,Le=function(e,t){var n,r,a,u,o,s=e.target,l=e.global,c=e.stat;if(n=l?i:c?i[s]||$(s,{}):(i[s]||{}).prototype)for(r in t){if(u=t[r],a=e.noTargetGet?(o=Oe(n,r))&&o.value:n[r],!$e(l?r:s+(c?".":"#")+r,e.forced)&&void 0!==a){if(typeof u==typeof a)continue;be(u,a)}(e.sham||a&&a.sham)&&S(u,"sham",!0),re(n,r,u,e)}},_e=Array.isArray||function(e){return"Array"==h(e)},Be=function(e){return Object(d(e))},Ne=function(e,t,n){var r=F(t);r in e?w.f(e,r,c(0,n)):e[r]=n},Ie=!!Object.getOwnPropertySymbols&&!a((function(){return!String(Symbol())})),Pe=Ie&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Re=H("wks"),je=i.Symbol,He=Pe?je:je&&je.withoutSetter||z,Ue=function(e){return M(Re,e)||(Ie&&M(je,e)?Re[e]=je[e]:Re[e]=He("Symbol."+e)),Re[e]},qe=Ue("species"),ze=function(e,t){var n;return _e(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!_e(n.prototype)?m(n)&&null===(n=n[qe])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Ze=ue("navigator","userAgent")||"",Ve=i.process,Ke=Ve&&Ve.versions,Xe=Ke&&Ke.v8;Xe?te=(ee=Xe.split("."))[0]+ee[1]:Ze&&(!(ee=Ze.match(/Edge\/(\d+)/))||ee[1]>=74)&&(ee=Ze.match(/Chrome\/(\d+)/))&&(te=ee[1]);var We=te&&+te,Ye=Ue("species"),Ge=function(e){return We>=51||!a((function(){var t=[];return(t.constructor={})[Ye]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Je=Ue("isConcatSpreadable"),Qe=9007199254740991,et="Maximum allowed index exceeded",tt=We>=51||!a((function(){var e=[];return e[Je]=!1,e.concat()[0]!==e})),nt=Ge("concat"),rt=function(e){if(!m(e))return!1;var t=e[Je];return void 0!==t?!!t:_e(e)};Le({target:"Array",proto:!0,forced:!tt||!nt},{concat:function(e){var t,n,r,i,a,u=Be(this),o=ze(u,0),s=0;for(t=-1,r=arguments.length;t<r;t++)if(rt(a=-1===t?u:arguments[t])){if(s+(i=pe(a.length))>Qe)throw TypeError(et);for(n=0;n<i;n++,s++)n in a&&Ne(o,s,a[n])}else{if(s>=Qe)throw TypeError(et);Ne(o,s++,a)}return o.length=s,o}});var it,at=Object.keys||function(e){return Fe(e,ye)},ut=u?Object.defineProperties:function(e,t){k(e);for(var n,r=at(t),i=r.length,a=0;i>a;)w.f(e,n=r[a++],t[n]);return e},ot=ue("document","documentElement"),st=V("IE_PROTO"),lt=function(){},ct=function(e){return"<script>"+e+"</"+"script>"},pt=function(){try{it=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;pt=it?function(e){e.write(ct("")),e.close();var t=e.parentWindow.Object;return e=null,t}(it):((t=E("iframe")).style.display="none",ot.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(ct("document.F=Object")),e.close(),e.F);for(var n=ye.length;n--;)delete pt.prototype[ye[n]];return pt()};K[st]=!0;var ht=Object.create||function(e,t){var n;return null!==e?(lt.prototype=k(e),n=new lt,lt.prototype=null,n[st]=e):n=pt(),void 0===t?n:ut(n,t)},ft=Ue("unscopables"),gt=Array.prototype;null==gt[ft]&&w.f(gt,ft,{configurable:!0,value:ht(null)});var dt,vt=Object.defineProperty,mt={},Ft=function(e){throw e},yt=function(e,t){if(M(mt,e))return mt[e];t||(t={});var n=[][e],r=!!M(t,"ACCESSORS")&&t.ACCESSORS,i=M(t,0)?t[0]:Ft,o=M(t,1)?t[1]:void 0;return mt[e]=!!n&&!a((function(){if(r&&!u)return!0;var e={length:-1};r?vt(e,1,{enumerable:!0,get:Ft}):e[1]=1,n.call(e,i,o)}))},Mt=ve.includes;Le({target:"Array",proto:!0,forced:!yt("indexOf",{ACCESSORS:!0,1:0})},{includes:function(e){return Mt(this,e,arguments.length>1?arguments[1]:void 0)}}),dt="includes",gt[ft][dt]=!0;var Tt,Dt,Et=[].join,bt=g!=Object,Ct=(Tt=",",!!(Dt=[]["join"])&&a((function(){Dt.call(null,Tt||function(){throw 1},1)})));Le({target:"Array",proto:!0,forced:bt||!Ct},{join:function(e){return Et.call(v(this),void 0===e?",":e)}});var At=Ge("splice"),kt=yt("splice",{ACCESSORS:!0,0:0,1:2}),xt=Math.max,wt=Math.min,St=9007199254740991,$t="Maximum allowed length exceeded";Le({target:"Array",proto:!0,forced:!At||!kt},{splice:function(e,t){var n,r,i,a,u,o,s=Be(this),l=pe(s.length),c=ge(e,l),p=arguments.length;if(0===p?n=r=0:1===p?(n=0,r=l-c):(n=p-2,r=wt(xt(le(t),0),l-c)),l+n-r>St)throw TypeError($t);for(i=ze(s,r),a=0;a<r;a++)(u=c+a)in s&&Ne(i,a,s[u]);if(i.length=r,n<r){for(a=c;a<l-r;a++)o=a+n,(u=a+r)in s?s[o]=s[u]:delete s[o];for(a=l;a>l-r+n;a--)delete s[a-1]}else if(n>r)for(a=l-r;a>c;a--)o=a+n-1,(u=a+r-1)in s?s[o]=s[u]:delete s[o];for(a=0;a<n;a++)s[a+c]=arguments[a+2];return s.length=l-r+n,i}});var Ot=Object.assign,Lt=Object.defineProperty,_t=!Ot||a((function(){if(u&&1!==Ot({b:1},Ot(Lt({},"a",{enumerable:!0,get:function(){Lt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=Ot({},e)[n]||at(Ot({},t)).join("")!=r}))?function(e,t){for(var n=Be(e),r=arguments.length,i=1,a=De.f,o=l.f;r>i;)for(var s,c=g(arguments[i++]),p=a?at(c).concat(a(c)):at(c),h=p.length,f=0;h>f;)s=p[f++],u&&!o.call(c,s)||(n[s]=c[s]);return n}:Ot;Le({target:"Object",stat:!0,forced:Object.assign!==_t},{assign:_t});var Bt=function(){var e=k(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function Nt(e,t){return RegExp(e,t)}var It={UNSUPPORTED_Y:a((function(){var e=Nt("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:a((function(){var e=Nt("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Pt=RegExp.prototype.exec,Rt=String.prototype.replace,jt=Pt,Ht=function(){var e=/a/,t=/b*/g;return Pt.call(e,"a"),Pt.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Ut=It.UNSUPPORTED_Y||It.BROKEN_CARET,qt=void 0!==/()??/.exec("")[1];(Ht||qt||Ut)&&(jt=function(e){var t,n,r,i,a=this,u=Ut&&a.sticky,o=Bt.call(a),s=a.source,l=0,c=e;return u&&(-1===(o=o.replace("y","")).indexOf("g")&&(o+="g"),c=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(s="(?: "+s+")",c=" "+c,l++),n=new RegExp("^(?:"+s+")",o)),qt&&(n=new RegExp("^"+s+"$(?!\\s)",o)),Ht&&(t=a.lastIndex),r=Pt.call(u?n:a,c),u?r?(r.input=r.input.slice(l),r[0]=r[0].slice(l),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:Ht&&r&&(a.lastIndex=a.global?r.index+r[0].length:t),qt&&r&&r.length>1&&Rt.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var zt=jt;Le({target:"RegExp",proto:!0,forced:/./.exec!==zt},{exec:zt});var Zt=Ue("match"),Vt=function(e){var t;return m(e)&&(void 0!==(t=e[Zt])?!!t:"RegExp"==h(e))},Kt=function(e){if(Vt(e))throw TypeError("The method doesn't accept regular expressions");return e},Xt=Ue("match");Le({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Xt]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~String(d(this)).indexOf(Kt(e),arguments.length>1?arguments[1]:void 0)}});var Wt=Ue("species"),Yt=!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Gt="$0"==="a".replace(/./,"$0"),Jt=Ue("replace"),Qt=!!/./[Jt]&&""===/./[Jt]("a","$0"),en=!a((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),tn=function(e,t,n,r){var i=Ue(e),u=!a((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=u&&!a((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Wt]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!u||!o||"replace"===e&&(!Yt||!Gt||Qt)||"split"===e&&!en){var s=/./[i],l=n(i,""[e],(function(e,t,n,r,i){return t.exec===zt?u&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Gt,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Qt}),c=l[0],p=l[1];re(String.prototype,e,c),re(RegExp.prototype,i,2==t?function(e,t){return p.call(e,this,t)}:function(e){return p.call(e,this)})}r&&S(RegExp.prototype[i],"sham",!0)},nn=function(e){return function(t,n){var r,i,a=String(d(t)),u=le(n),o=a.length;return u<0||u>=o?e?"":void 0:(r=a.charCodeAt(u))<55296||r>56319||u+1===o||(i=a.charCodeAt(u+1))<56320||i>57343?e?a.charAt(u):r:e?a.slice(u,u+2):i-56320+(r-55296<<10)+65536}},rn={codeAt:nn(!1),charAt:nn(!0)}.charAt,an=function(e,t,n){return t+(n?rn(e,t).length:1)},un=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==h(e))throw TypeError("RegExp#exec called on incompatible receiver");return zt.call(e,t)};tn("match",1,(function(e,t,n){return[function(t){var n=d(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=k(e),a=String(this);if(!i.global)return un(i,a);var u=i.unicode;i.lastIndex=0;for(var o,s=[],l=0;null!==(o=un(i,a));){var c=String(o[0]);s[l]=c,""===c&&(i.lastIndex=an(a,pe(i.lastIndex),u)),l++}return 0===l?null:s}]}));var on=Math.max,sn=Math.min,ln=Math.floor,cn=/\$([$&'`]|\d\d?|<[^>]*>)/g,pn=/\$([$&'`]|\d\d?)/g;tn("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,a=r.REPLACE_KEEPS_$0,u=i?"$":"$0";return[function(n,r){var i=d(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&a||"string"==typeof r&&-1===r.indexOf(u)){var s=n(t,e,this,r);if(s.done)return s.value}var l=k(e),c=String(this),p="function"==typeof r;p||(r=String(r));var h=l.global;if(h){var f=l.unicode;l.lastIndex=0}for(var g=[];;){var d=un(l,c);if(null===d)break;if(g.push(d),!h)break;""===String(d[0])&&(l.lastIndex=an(c,pe(l.lastIndex),f))}for(var v,m="",F=0,y=0;y<g.length;y++){d=g[y];for(var M=String(d[0]),T=on(sn(le(d.index),c.length),0),D=[],E=1;E<d.length;E++)D.push(void 0===(v=d[E])?v:String(v));var b=d.groups;if(p){var C=[M].concat(D,T,c);void 0!==b&&C.push(b);var A=String(r.apply(void 0,C))}else A=o(M,c,T,D,b,r);T>=F&&(m+=c.slice(F,T)+A,F=T+M.length)}return m+c.slice(F)}];function o(e,n,r,i,a,u){var o=r+e.length,s=i.length,l=pn;return void 0!==a&&(a=Be(a),l=cn),t.call(u,l,(function(t,u){var l;switch(u.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(o);case"<":l=a[u.slice(1,-1)];break;default:var c=+u;if(0===c)return t;if(c>s){var p=ln(c/10);return 0===p?t:p<=s?void 0===i[p-1]?u.charAt(1):i[p-1]+u.charAt(1):t}l=i[c-1]}return void 0===l?"":l}))}}));var hn=Ue("species"),fn=function(e,t){var n,r=k(e).constructor;return void 0===r||null==(n=k(r)[hn])?t:function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}(n)},gn=[].push,dn=Math.min,vn=4294967295,mn=!a((function(){return!RegExp(vn,"y")}));tn("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(d(this)),i=void 0===n?vn:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Vt(e))return t.call(r,e,i);for(var a,u,o,s=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,p=new RegExp(e.source,l+"g");(a=zt.call(p,r))&&!((u=p.lastIndex)>c&&(s.push(r.slice(c,a.index)),a.length>1&&a.index<r.length&&gn.apply(s,a.slice(1)),o=a[0].length,c=u,s.length>=i));)p.lastIndex===a.index&&p.lastIndex++;return c===r.length?!o&&p.test("")||s.push(""):s.push(r.slice(c)),s.length>i?s.slice(0,i):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=d(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,n):r.call(String(i),t,n)},function(e,i){var a=n(r,e,this,i,r!==t);if(a.done)return a.value;var u=k(e),o=String(this),s=fn(u,RegExp),l=u.unicode,c=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(mn?"y":"g"),p=new s(mn?u:"^(?:"+u.source+")",c),h=void 0===i?vn:i>>>0;if(0===h)return[];if(0===o.length)return null===un(p,o)?[o]:[];for(var f=0,g=0,d=[];g<o.length;){p.lastIndex=mn?g:0;var v,m=un(p,mn?o:o.slice(g));if(null===m||(v=dn(pe(p.lastIndex+(mn?0:g)),o.length))===f)g=an(o,g,l);else{if(d.push(o.slice(f,g)),d.length===h)return d;for(var F=1;F<=m.length-1;F++)if(d.push(m[F]),d.length===h)return d;g=f=v}}return d.push(o.slice(f)),d}]}),!mn);var Fn="\t\n\v\f\r                　\u2028\u2029\ufeff",yn="["+Fn+"]",Mn=RegExp("^"+yn+yn+"*"),Tn=RegExp(yn+yn+"*$"),Dn=function(e){return function(t){var n=String(d(t));return 1&e&&(n=n.replace(Mn,"")),2&e&&(n=n.replace(Tn,"")),n}},En={start:Dn(1),end:Dn(2),trim:Dn(3)},bn=En.trim;function Cn(e){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function An(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sn(e,t)}function wn(e){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sn(e,t){return(Sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function On(e,t,n){return(On=$n()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Sn(i,n.prototype),i}).apply(null,arguments)}function Ln(e){var t="function"==typeof Map?new Map:void 0;return(Ln=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return On(e,arguments,wn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Sn(r,e)})(e)}function _n(e){return function(e){if(Array.isArray(e))return Nn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Bn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bn(e,t){if(e){if("string"==typeof e)return Nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nn(e,t):void 0}}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function In(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Bn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function Pn(e,t){Pn=function(e,t){return new a(e,void 0,t)};var n=Ln(RegExp),r=RegExp.prototype,i=new WeakMap;function a(e,t,r){var a=n.call(this,e,t);return i.set(a,r||i.get(e)),a}function u(e,t){var n=i.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return xn(a,n),a.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=u(t,this)),t},a.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=i.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var a=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(u(e,a)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},Pn.apply(this,arguments)}Le({target:"String",proto:!0,forced:function(e){return a((function(){return!!Fn[e]()||"​᠎"!="​᠎"[e]()||Fn[e].name!==e}))}("trim")},{trim:function(){return bn(this)}}),Le({target:"Object",stat:!0,forced:a((function(){at(1)}))},{keys:function(e){return at(Be(e))}});var Rn=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return k(n),function(e){if(!m(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),jn=Ue("species"),Hn=w.f,Un=Te.f,qn=ne.set,zn=Ue("match"),Zn=i.RegExp,Vn=Zn.prototype,Kn=/a/g,Xn=/a/g,Wn=new Zn(Kn)!==Kn,Yn=It.UNSUPPORTED_Y;if(u&&$e("RegExp",!Wn||Yn||a((function(){return Xn[zn]=!1,Zn(Kn)!=Kn||Zn(Xn)==Xn||"/a/i"!=Zn(Kn,"i")})))){for(var Gn=function(e,t){var n,r=this instanceof Gn,i=Vt(e),a=void 0===t;if(!r&&i&&e.constructor===Gn&&a)return e;Wn?i&&!a&&(e=e.source):e instanceof Gn&&(a&&(t=Bt.call(e)),e=e.source),Yn&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var u,o,s,l,c,p=(u=Wn?new Zn(e,t):Zn(e,t),o=r?this:Vn,s=Gn,Rn&&"function"==typeof(l=o.constructor)&&l!==s&&m(c=l.prototype)&&c!==s.prototype&&Rn(u,c),u);return Yn&&n&&qn(p,{sticky:n}),p},Jn=function(e){e in Gn||Hn(Gn,e,{configurable:!0,get:function(){return Zn[e]},set:function(t){Zn[e]=t}})},Qn=Un(Zn),er=0;Qn.length>er;)Jn(Qn[er++]);Vn.constructor=Gn,Gn.prototype=Vn,re(i,"RegExp",Gn)}!function(e){var t=ue(e),n=w.f;u&&t&&!t[jn]&&n(t,jn,{configurable:!0,get:function(){return this}})}("RegExp"),u&&("g"!=/./g.flags||It.UNSUPPORTED_Y)&&w.f(RegExp.prototype,"flags",{configurable:!0,get:Bt});var tr="toString",nr=RegExp.prototype,rr=nr.toString,ir=a((function(){return"/a/b"!=rr.call({source:"a",flags:"b"})})),ar=rr.name!=tr;(ir||ar)&&re(RegExp.prototype,tr,(function(){var e=k(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in nr)?Bt.call(e):n)}),{unsafe:!0});var ur,or={ASCIIPunctuation:/[!"#$%&'()*+,\-./:;<=>?@[\]^_`{|}~\\]/,NotTriggerChar:/[^`_*[\]()<>!~]/,Scheme:/[A-Za-z][A-Za-z0-9+.-]{1,31}/,Email:/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/,HTMLOpenTag:/<HTMLTagName(?:HTMLAttribute)*\s*\/?>/,HTMLCloseTag:/<\/HTMLTagName\s*>/,HTMLTagName:/[A-Za-z][A-Za-z0-9-]*/,HTMLComment:/<!--(?:[^>-]|(?:[^>-](?:[^-]|-[^-])*[^-]))-->/,HTMLPI:/<\?(?:|.|(?:[^?]|\?[^>])*)\?>/,HTMLDeclaration:/<![A-Z]+\s[^>]*>/,HTMLCDATA:/<!\[CDATA\[.*?\]\]>/,HTMLAttribute:/\s+[A-Za-z_:][A-Za-z0-9_.:-]*(?:HTMLAttValue)?/,HTMLAttValue:/\s*=\s*(?:(?:'[^']*')|(?:"[^"]*")|(?:[^\s"'=<>`]+))/,KnownTag:/address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul/},sr=new RegExp(/^(?:[!"#$%&'()*+,\-./:;<=>?@[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B])/),lr=new RegExp(/(?:[!"#$%&'()*+,\-./:;<=>?@[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B])$/),cr={TMH1:{regexp:/^( {0,3}#\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH1">$1</span>$$2<span class="TMMark TMMark_TMH1">$3</span>'},TMH2:{regexp:/^( {0,3}##\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH2">$1</span>$$2<span class="TMMark TMMark_TMH2">$3</span>'},TMH3:{regexp:/^( {0,3}###\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH3">$1</span>$$2<span class="TMMark TMMark_TMH3">$3</span>'},TMH4:{regexp:/^( {0,3}####\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH4">$1</span>$$2<span class="TMMark TMMark_TMH4">$3</span>'},TMH5:{regexp:/^( {0,3}#####\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH5">$1</span>$$2<span class="TMMark TMMark_TMH5">$3</span>'},TMH6:{regexp:/^( {0,3}######\s)(.*?)((?:\s+#+\s*)?)$/,replacement:'<span class="TMMark TMMark_TMH6">$1</span>$$2<span class="TMMark TMMark_TMH6">$3</span>'},TMBlockquote:{regexp:/^( {0,3}>[ ]?)(.*)$/,replacement:'<span class="TMMark TMMark_TMBlockquote">$1</span>$$2'},TMCodeFenceBacktickOpen:{regexp:Pn(/^( {0,3}(````*)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)([\0-_a-\uFFFF]*?)([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)$/,{seq:2}),replacement:'<span class="TMMark TMMark_TMCodeFenceBacktick">$1</span><span class="TMInfoString">$3</span>$4'},TMCodeFenceTildeOpen:{regexp:Pn(/^( {0,3}(~~~~*)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)(.*?)([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)$/,{seq:2}),replacement:'<span class="TMMark TMMark_TMCodeFenceTilde">$1</span><span class="TMInfoString">$3</span>$4'},TMCodeFenceBacktickClose:{regexp:Pn(/^( {0,3}(````*))([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)$/,{seq:2}),replacement:'<span class="TMMark TMMark_TMCodeFenceBacktick">$1</span>$3'},TMCodeFenceTildeClose:{regexp:Pn(/^( {0,3}(~~~~*))([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)$/,{seq:2}),replacement:'<span class="TMMark TMMark_TMCodeFenceTilde">$1</span>$3'},TMBlankLine:{regexp:/^([ \t]*)$/,replacement:"$0"},TMSetextH1Marker:{regexp:/^ {0,3}=+\s*$/,replacement:'<span class="TMMark TMMark_TMSetextH1Marker">$0</span>'},TMSetextH2Marker:{regexp:/^ {0,3}-+\s*$/,replacement:'<span class="TMMark TMMark_TMSetextH1Marker">$0</span>'},TMHR:{regexp:/^( {0,3}(\*[ \t]*\*[ \t]*\*[ \t*]*)|(-[ \t]*-[ \t]*-[ \t-]*)|(_[ \t]*_[ \t]*_[ \t_]*))$/,replacement:'<span class="TMMark TMMark_TMHR">$0</span>'},TMUL:{regexp:/^( {0,3}[+*-] {1,4})(.*)$/,replacement:'<span class="TMMark TMMark_TMUL">$1</span>$$2'},TMOL:{regexp:/^( {0,3}\d{1,9}[.)] {1,4})(.*)$/,replacement:'<span class="TMMark TMMark_TMOL">$1</span>$$2'},TMIndentedCode:{regexp:/^( {4}|\t)(.*)$/,replacement:'<span class="TMMark TMMark_TMIndentedCode">$1</span>$2'},TMLinkReferenceDefinition:{regexp:/^( {0,3}\[\s*)([^\s\]](?:[^\]]|\\\])*?)(\s*\]:\s*)((?:[^\s<>]+)|(?:<(?:[^<>\\]|\\.)*>))?(\s*)((?:\((?:[^()\\]|\\.)*\))|(?:"(?:[^"\\]|\\.)*")|(?:'(?:[^'\\]|\\.)*'))?(\s*)$/,replacement:'<span class="TMMark TMMark_TMLinkReferenceDefinition">$1</span><span class="TMLinkLabel TMLinkLabel_Definition">$2</span><span class="TMMark TMMark_TMLinkReferenceDefinition">$3</span><span class="TMLinkDestination">$4</span>$5<span class="TMLinkTitle">$6</span>$7',labelPlaceholder:2}},pr=[{start:/^ {0,3}<(?:script|pre|style)(?:\s|>|$)/i,end:/(?:<\/script>|<\/pre>|<\/style>)/i,paraInterrupt:!0},{start:/^ {0,3}<!--/,end:/-->/,paraInterrupt:!0},{start:/^ {0,3}<\?/,end:/\?>/,paraInterrupt:!0},{start:/^ {0,3}<![A-Z]/,end:/>/,paraInterrupt:!0},{start:/^ {0,3}<!\[CDATA\[/,end:/\]\]>/,paraInterrupt:!0},{start:/^ {0,3}(?:<|<\/)(?:KnownTag)(?:\s|>|\/>|$)/i,end:!1,paraInterrupt:!0},{start:/^ {0,3}(?:HTMLOpenTag|HTMLCloseTag)\s*$/,end:!1,paraInterrupt:!1}],hr={escape:{regexp:/^\\(ASCIIPunctuation)/,replacement:'<span class="TMMark TMMark_TMEscape">\\</span>$1'},code:{regexp:/^(`+)((?:[^`])|(?:[^`].*?[^`]))(\1)/,replacement:'<span class="TMMark TMMark_TMCode">$1</span><code class="TMCode">$2</code><span class="TMMark TMMark_TMCode">$3</span>'},autolink:{regexp:/^<((?:Scheme:[^\s<>]*)|(?:Email))>/,replacement:'<span class="TMMark TMMark_TMAutolink">&lt;</span><span class="TMAutolink">$1</span><span class="TMMark TMMark_TMAutolink">&gt;</span>'},html:{regexp:/^((?:HTMLOpenTag)|(?:HTMLCloseTag)|(?:HTMLComment)|(?:HTMLPI)|(?:HTMLDeclaration)|(?:HTMLCDATA))/,replacement:'<span class="TMHTML">$1</span>'},linkOpen:{regexp:/^\[/,replacement:""},imageOpen:{regexp:/^!\[/,replacement:""},linkLabel:{regexp:/^(\[\s*)([^\]]*?)(\s*\])/,replacement:"",labelPlaceholder:2},default:{regexp:/^(.|(?:NotTriggerChar+))/,replacement:"$1"}},fr=new RegExp(Object.keys(or).join("|")),gr=In(_n(Object.keys(hr)));try{for(gr.s();!(ur=gr.n()).done;){for(var dr=ur.value,vr=hr[dr].regexp.source;vr.match(fr);)vr=vr.replace(fr,(function(e){return or[e].source}));hr[dr].regexp=new RegExp(vr,hr[dr].regexp.flags)}}catch(e){gr.e(e)}finally{gr.f()}for(var mr=0,Fr=pr;mr<Fr.length;mr++){for(var yr=Fr[mr],Mr=yr.start.source;Mr.match(fr);)Mr=Mr.replace(fr,(function(e){return or[e].source}));yr.start=new RegExp(Mr,yr.start.flags)}function Tr(e){return(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Dr={bold:{type:"inline",className:"TMStrong",set:{pre:"**",post:"**"},unset:{prePattern:/(?:\*\*|__)$/,postPattern:/^(?:\*\*|__)/}},italic:{type:"inline",className:"TMEm",set:{pre:"*",post:"*"},unset:{prePattern:/(?:\*|_)$/,postPattern:/^(?:\*|_)/}},code:{type:"inline",className:"TMCode",set:{pre:"`",post:"`"},unset:{prePattern:/`+$/,postPattern:/^`+/}},strikethrough:{type:"inline",className:"TMStrikethrough",set:{pre:"~~",post:"~~"},unset:{prePattern:/~~$/,postPattern:/^~~/}},h1:{type:"line",className:"TMH1",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"# $2"},unset:{pattern:/^( {0,3}#\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},h2:{type:"line",className:"TMH2",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"## $2"},unset:{pattern:/^( {0,3}##\s+)(.*?)((?:\s+#+\s*)?)$/,replacement:"$2"}},ul:{type:"line",className:"TMUL",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"- $2"},unset:{pattern:/^( {0,3}[+*-] {1,4})(.*)$/,replacement:"$2"}},ol:{type:"line",className:"TMOL",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"$#. $2"},unset:{pattern:/^( {0,3}\d{1,9}[.)] {1,4})(.*)$/,replacement:"$2"}},blockquote:{type:"line",className:"TMBlockquote",set:{pattern:/^( {0,3}(?:(?:#+|[0-9]{1,9}[).]|[>\-*+])\s+)?)(.*)$/,replacement:"> $2"},unset:{pattern:/^( {0,3}>[ ]?)(.*)$/,replacement:"$2"}}},Er=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};An(this,e),this.e=null,this.textarea=null,this.lines=[],this.lineElements=[],this.lineTypes=[],this.lineCaptures=[],this.lineReplacements=[],this.linkLabels=[],this.lineDirty=[],this.lastCommandState=null,this.listeners={change:[],selection:[]};var n=t.element;this.textarea=t.textarea,this.textarea&&!this.textarea.tagName&&(this.textarea=document.getElementById(this.textarea),n||(n=this.textarea)),n&&!n.tagName&&(n=document.getElementById(t.element)),n||(n=document.getElementsByTagName("body")[0]),"TEXTAREA"==n.tagName&&(this.textarea=n,n=this.textarea.parentNode),this.textarea&&(this.textarea.style.display="none"),this.createEditorElement(n),this.setContent(t.content||!!this.textarea&&this.textarea.value||"# Hello TinyMDE!\nEdit **here**")}var t,n,r;return t=e,(n=[{key:"createEditorElement",value:function(e){var t=this;this.e=document.createElement("div"),this.e.className="TinyMDE",this.e.contentEditable=!0,this.e.style.whiteSpace="pre-wrap",this.e.style.webkitUserModify="read-write-plaintext-only",this.textarea&&this.textarea.parentNode==e&&this.textarea.nextSibling?e.insertBefore(this.e,this.textarea.nextSibling):e.appendChild(this.e),this.e.addEventListener("input",(function(e){return t.handleInputEvent(e)})),document.addEventListener("selectionchange",(function(e){return t.handleSelectionChangeEvent(e)})),this.e.addEventListener("paste",(function(e){return t.handlePaste(e)})),this.lineElements=this.e.childNodes}},{key:"setContent",value:function(e){for(;this.e.firstChild;)this.e.removeChild(this.e.firstChild);this.lines=e.split(/(?:\r\n|\r|\n)/),this.lineDirty=[];for(var t=0;t<this.lines.length;t++){var n=document.createElement("div");this.e.appendChild(n),this.lineDirty.push(!0)}this.lineTypes=new Array(this.lines.length),this.updateFormatting(),this.fireChange()}},{key:"getContent",value:function(){return this.lines.join("\n")}},{key:"updateFormatting",value:function(){this.updateLineTypes(),this.updateLinkLabels(),this.applyLineTypes()}},{key:"updateLinkLabels",value:function(){this.linkLabels=[];for(var e=0;e<this.lines.length;e++)"TMLinkReferenceDefinition"==this.lineTypes[e]&&this.linkLabels.push(this.lineCaptures[e][cr.TMLinkReferenceDefinition.labelPlaceholder])}},{key:"replace",value:function(e,t){var n=this;return e.replace(/\$\$([0-9])/g,(function(e,r){return'<span class="TMInlineFormatted">'.concat(n.processInlineStyles(t[r]),"</span>")})).replace(/\$([0-9])/g,(function(e,n){return Tr(t[n])}))}},{key:"applyLineTypes",value:function(){for(var e=0;e<this.lines.length;e++){if(this.lineDirty[e]){var t=this.replace(this.lineReplacements[e],this.lineCaptures[e]);this.lineElements[e].className=this.lineTypes[e],this.lineElements[e].removeAttribute("style"),this.lineElements[e].innerHTML=""==t?"<br />":t}this.lineElements[e].dataset.lineNum=e}}},{key:"updateLineTypes",value:function(){for(var e=!1,t=0,n=!1,r=0;r<this.lines.length;r++){var i="TMPara",a=[this.lines[r]],u="$$0";if("TMCodeFenceBacktickOpen"==e){var o=cr.TMCodeFenceBacktickClose.regexp.exec(this.lines[r]);o&&o.groups.seq.length>=t?(i="TMCodeFenceBacktickClose",u=cr.TMCodeFenceBacktickClose.replacement,a=o,e=!1):(i="TMFencedCodeBacktick",u="$0",a=[this.lines[r]])}else if("TMCodeFenceTildeOpen"==e){var s=cr.TMCodeFenceTildeClose.regexp.exec(this.lines[r]);s&&s.groups.seq.length>=t?(i="TMCodeFenceTildeClose",u=cr.TMCodeFenceTildeClose.replacement,a=s,e=!1):(i="TMFencedCodeTilde",u="$0",a=[this.lines[r]])}if("TMPara"==i&&!1===n){var l,c=In(pr);try{for(c.s();!(l=c.n()).done;){var p=l.value;if(this.lines[r].match(p.start)&&(p.paraInterrupt||0==r||"TMPara"!=this.lineTypes[r-1]&&"TMUL"!=this.lineTypes[r-1]&&"TMOL"!=this.lineTypes[r-1]&&"TMBlockquote"!=this.lineTypes[r-1])){n=p;break}}}catch(e){c.e(e)}finally{c.f()}}if(!1!==n&&(i="TMHTMLBlock",u="$0",a=[this.lines[r]],n.end?this.lines[r].match(n.end)&&(n=!1):(r==this.lines.length-1||this.lines[r+1].match(cr.TMBlankLine.regexp))&&(n=!1)),"TMPara"==i)for(var h in cr)if(cr[h].regexp){var f=cr[h].regexp.exec(this.lines[r]);if(f){i=h,u=cr[h].replacement,a=f;break}}if("TMCodeFenceBacktickOpen"!=i&&"TMCodeFenceTildeOpen"!=i||(e=i,t=a.groups.seq.length),"TMIndentedCode"!=i&&"TMLinkReferenceDefinition"!=i||!(r>0)||"TMPara"!=this.lineTypes[r-1]&&"TMUL"!=this.lineTypes[r-1]&&"TMOL"!=this.lineTypes[r-1]&&"TMBlockquote"!=this.lineTypes[r-1]||(i="TMPara",a=[this.lines[r]],u="$$0"),"TMSetextH2Marker"==i){var g=cr.TMUL.regexp.exec(this.lines[r]);g&&(i="TMUL",u=cr.TMUL.replacement,a=g)}if("TMSetextH1Marker"==i||"TMSetextH2Marker"==i)if(0==r||"TMPara"!=this.lineTypes[r-1]){var d=cr.TMHR.regexp.exec(this.lines[r]);d?(i="TMHR",a=d,u=cr.TMHR.replacement):(i="TMPara",a=[this.lines[r]],u="$$0")}else{var v=r-1,m="TMSetextH1Marker"==i?"TMSetextH1":"TMSetextH2";do{this.lineTypes[m]!=m&&(this.lineTypes[v]=m,this.lineDirty[m]=!0),this.lineReplacements[v]="$$0",this.lineCaptures[v]=[this.lines[v]],v--}while(v>=0&&"TMPara"==this.lineTypes[v])}this.lineTypes[r]!=i&&(this.lineTypes[r]=i,this.lineDirty[r]=!0),this.lineReplacements[r]=u,this.lineCaptures[r]=a}}},{key:"updateLineContentsAndFormatting",value:function(){this.clearDirtyFlag(),this.updateLineContents(),this.updateFormatting()}},{key:"parseLinkOrImage",value:function(e,t){var n=t?2:1,r=e.substr(0,n),i=t?"TMImage":"TMLink",a=n,u=1,o=!1,s=!1,l=[],c=[];e:for(;a<e.length&&!1===o;){for(var p=e.substr(a),h=0,f=["escape","code","autolink","html"];h<f.length;h++){var g=hr[f[h]].regexp.exec(p);if(g){a+=g[0].length;continue e}}if(p.match(hr.imageOpen.regexp))u++,a+=2;else if(p.match(hr.linkOpen.regexp)){if(u++,!t&&this.parseLinkOrImage(p,!1))return!1;a+=1}else p.match(/^\]/)&&0==--u?(o=e.substr(n,a-n),a++):a++}if(!1===o)return!1;var d=a<e.length?e.substr(a,1):"";if("["==d){var v=e.substr(a),m=hr.linkLabel.regexp.exec(v);if(!m)return!1;a+=m[0].length,l.push(m[1],m[2],m[3]),s=m[hr.linkLabel.labelPlaceholder]?m[hr.linkLabel.labelPlaceholder]:o.trim()}else if("("!=d)s=o.trim();else{a++;for(var F=1;a<e.length&&F>0;){var y=e.substr(a),M=/^\s+/.exec(y);if(M){switch(c.length){case 0:case 1:c.push(M[0]);break;case 2:if(c[0].match(/</))c[1]=c[1].concat(M[0]);else{if(1!=F)return!1;c.push(""),c.push(M[0])}break;case 3:c.push(M[0]);break;case 4:return!1;case 5:c.push("");case 6:c[5]=c[5].concat(M[0]);break;case 7:c[6]=c[6].concat(M[0]);break;default:return!1}a+=M[0].length}else if(M=hr.escape.regexp.exec(y)){switch(c.length){case 0:c.push("");case 1:c.push(M[0]);break;case 2:c[1]=c[1].concat(M[0]);break;case 3:case 4:return!1;case 5:c.push("");case 6:c[5]=c[5].concat(M[0]);break;default:return!1}a+=M[0].length}else if(c.length<2&&y.match(/^</))0==c.length&&c.push(""),c[0]=c[0].concat("<"),a++;else if(1!=c.length&&2!=c.length||!y.match(/^>/))if(!(M=/^["']/.exec(y))||0!=c.length&&1!=c.length&&4!=c.length)if(!M||5!=c.length&&6!=c.length||c[4]!=M[0])if(y.match(/^\(/)){switch(c.length){case 0:c.push("");case 1:c.push("");case 2:c[1]=c[1].concat("("),c[0].match(/<$/)||F++;break;case 3:c.push("");case 4:c.push("(");break;case 5:c.push("");case 6:if("("==c[4])return!1;c[5]=c[5].concat("(");break;default:return!1}a++}else if(y.match(/^\)/)){if(c.length<=2){for(;c.length<2;)c.push("");c[0].match(/<$/)||F--,F>0&&(c[1]=c[1].concat(")"))}else 5==c.length||6==c.length?"("==c[4]?(5==c.length&&c.push(""),c.push(")")):5==c.length?c.push(")"):c[5]=c[5].concat(")"):F--;if(0==F)for(;c.length<7;)c.push("");a++}else{if(!(M=/^./.exec(y)))throw"Infinite loop";switch(c.length){case 0:c.push("");case 1:c.push(M[0]);break;case 2:c[1]=c[1].concat(M[0]);break;case 3:case 4:return!1;case 5:c.push("");case 6:c[5]=c[5].concat(M[0]);break;default:return!1}a+=M[0].length}else 5==c.length&&c.push(""),c.push(M[0]),a++;else{for(;c.length<4;)c.push("");c.push(M[0]),a++}else 1==c.length&&c.push(""),c.push(">"),a++}if(F>0)return!1}if(!1!==s){var T,D=!1,E=In(this.linkLabels);try{for(E.s();!(T=E.n()).done;)if(T.value==s){D=!0;break}}catch(e){E.e(e)}finally{E.f()}var b=D?"TMLinkLabel TMLinkLabel_Valid":"TMLinkLabel TMLinkLabel_Invalid",C='<span class="TMMark TMMark_'.concat(i,'">').concat(r,'</span><span class="').concat(i," ").concat(l.length<3||!l[1]?b:"",'">').concat(this.processInlineStyles(o),'</span><span class="TMMark TMMark_').concat(i,'">]</span>');return l.length>=3&&(C=C.concat('<span class="TMMark TMMark_'.concat(i,'">').concat(l[0],"</span>"),'<span class="'.concat(b,'">').concat(l[1],"</span>"),'<span class="TMMark TMMark_'.concat(i,'">').concat(l[2],"</span>"))),{output:C,charCount:a}}if(c){for(;c.length<7;)c.push("");return{output:'<span class="TMMark TMMark_'.concat(i,'">').concat(r,'</span><span class="').concat(i,'">').concat(this.processInlineStyles(o),'</span><span class="TMMark TMMark_').concat(i,'">](').concat(c[0],'</span><span class="').concat(i,'Destination">').concat(c[1],'</span><span class="TMMark TMMark_').concat(i,'">').concat(c[2]).concat(c[3]).concat(c[4],'</span><span class="').concat(i,'Title">').concat(c[5],'</span><span class="TMMark TMMark_').concat(i,'">').concat(c[6],")</span>"),charCount:a}}return!1}},{key:"processInlineStyles",value:function(e){for(var t=this,n="",r=[],i=0,a=e,u=function(){for(var u=function(){var e=s[o],t=hr[e].regexp.exec(a);if(t)return a=a.substr(t[0].length),i+=t[0].length,n+=hr[e].replacement.replace(/\$([1-9])/g,(function(e,n){return Tr(t[n])})),{v:"continue|outer"}},o=0,s=["escape","code","autolink","html"];o<s.length;o++){var l=u();if("object"===Cn(l))return l.v}var c=a.match(hr.linkOpen.regexp),p=a.match(hr.imageOpen.regexp);if(p||c){var h=t.parseLinkOrImage(a,p);if(h)return n="".concat(n).concat(h.output),a=a.substr(h.charCount),i+=h.charCount,"continue|outer"}var f=/(^\*+)|(^_+)/.exec(a);if(f){var g=f[0].length,d=f[0],v=f[0][0];a=a.substr(f[0].length);var m=i>0?e.substr(0,i):" ",F=i+f[0].length<e.length?a:" ",y=F.match(sr),M=m.match(lr),T=F.match(/^\s/),D=m.match(/\s$/),E=!(T||y&&!D&&!M),b=!(D||M&&!T&&!y);if("_"==v&&E&&b&&(E=M,b=y),b)for(var C=r.length-1;g&&C>=0;)if(r[C].delimiter==v){for(;C<r.length-1;){var A=r.pop();n="".concat(A.output).concat(A.delimString.substr(0,A.count)).concat(n)}if(g>=2&&r[C].count>=2?(n='<span class="TMMark">'.concat(v).concat(v,'</span><strong class="TMStrong">').concat(n,'</strong><span class="TMMark">').concat(v).concat(v,"</span>"),g-=2,r[C].count-=2):(n='<span class="TMMark">'.concat(v,'</span><em class="TMEm">').concat(n,'</em><span class="TMMark">').concat(v,"</span>"),g-=1,r[C].count-=1),0==r[C].count){var k=r.pop();n="".concat(k.output).concat(n),C--}}else C--;return g&&E&&(r.push({delimiter:v,delimString:d,count:g,output:n}),n="",g=0),g&&(n="".concat(n).concat(d.substr(0,g))),i+=f[0].length,"continue|outer"}if(f=/^~~/.exec(a)){for(var x=!1,w=r.length-1;!x&&w>=0;)if("~"==r[w].delimiter){for(;w<r.length-1;){var S=r.pop();n="".concat(S.output).concat(S.delimString.substr(0,S.count)).concat(n)}n='<span class="TMMark">~~</span><del class="TMStrikethrough">'.concat(n,'</del><span class="TMMark">~~</span>');var $=r.pop();n="".concat($.output).concat(n),x=!0}else w--;return x||(r.push({delimiter:"~",delimString:"~~",count:2,output:n}),n=""),i+=f[0].length,a=a.substr(f[0].length),"continue|outer"}if(f=hr.default.regexp.exec(a))return a=a.substr(f[0].length),i+=f[0].length,n+=hr.default.replacement.replace(/\$([1-9])/g,(function(e,t){return Tr(f[t])})),"continue|outer";throw"Infinite loop!"};a;)u();for(;r.length;){var o=r.pop();n="".concat(o.output).concat(o.delimString.substr(0,o.count)).concat(n)}return n}},{key:"clearDirtyFlag",value:function(){this.lineDirty=new Array(this.lines.length);for(var e=0;e<this.lineDirty.length;e++)this.lineDirty[e]=!1}},{key:"updateLineContents",value:function(){var e=this.e.childElementCount-this.lines.length;if(e){for(var t=0;t<=this.lines.length&&t<=this.lineElements.length&&this.lineElements[t]&&this.lines[t]==this.lineElements[t].textContent;)t++;for(var n=-1;-n<this.lines.length&&-n<this.lineElements.length&&this.lines[this.lines.length+n]==this.lineElements[this.lineElements.length+n].textContent;)n--;var r=this.lines.length+n+1-t;r<-e&&(r=-e),r<0&&(r=0);for(var i=[],a=0;a<r+e;a++)i.push(this.lineElements[t+a].textContent);this.spliceLines(t,r,i,!1)}else for(var u=0;u<this.lineElements.length;u++){var o=this.lineElements[u].textContent;this.lines[u]!==o&&(this.lines[u]=o,this.lineDirty[u]=!0)}}},{key:"processNewParagraph",value:function(e){if(e){this.updateLineContents();var t=!1,n=e.col>0?e.row:e.row-1;switch(this.lineTypes[n]){case"TMUL":t="TMUL";break;case"TMOL":t="TMOL";break;case"TMIndentedCode":t="TMIndentedCode"}var r=this.lines[e.row].replace(/\n\n$/,"\n").split(/(?:\r\n|\n|\r)/);if(1!=r.length){if(this.spliceLines(e.row,1,r,!0),e.row++,e.col=0,t){var i=cr[t].regexp.exec(this.lines[e.row-1]);i&&(i[2]?("TMOL"==t&&(i[1]=i[1].replace(/\d{1,9}/,(function(e){return parseInt(e[0])+1}))),this.lines[e.row]="".concat(i[1]).concat(this.lines[e.row]),this.lineDirty[e.row]=!0,e.col=i[1].length):(this.lines[e.row-1]="",this.lineDirty[e.row-1]=!0))}this.updateFormatting()}else this.updateFormatting()}}},{key:"getSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=window.getSelection(),n=e?t.anchorNode:t.focusNode;if(!n)return null;var r=n.nodeType===Node.TEXT_NODE?e?t.anchorOffset:t.focusOffset:0;if(n==this.e)return{row:0,col:r};var i=this.computeColumn(n,r);if(null===i)return null;for(var a=n;a.parentElement!=this.e;)a=a.parentElement;var u=0;if(!a.dataset||!a.dataset.lineNum||a.previousSibling&&a.previousSibling.dataset.lineNum==a.dataset.lineNum)for(;a.previousSibling;)u++,a=a.previousSibling;else u=parseInt(a.dataset.lineNum);return{row:u,col:i,node:n}}},{key:"computeColumn",value:function(e,t){for(var n=e,r=t;n&&n.parentNode!=this.e;)n=n.parentNode;if(null==n)return null;for(n=e;n.parentNode!=this.e;)n.previousSibling?r+=(n=n.previousSibling).textContent.length:n=n.parentNode;return r}},{key:"computeNodeAndOffset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e>=this.lineElements.length&&(e=this.lineElements.length-1,t=this.lines[e].length),t>this.lines[e].length&&(t=this.lines[e].length);for(var r=this.lineElements[e],i=r.firstChild,a=!1,u={node:r.firstChild?r.firstChild:r,offset:0};i!=r;){if(!a&&i.nodeType===Node.TEXT_NODE)if(i.nodeValue.length>=t){if(!n||i.nodeValue.length!=t)return{node:i,offset:t};u={node:i,offset:t},t=0}else t-=i.nodeValue.length;!a&&i.firstChild?i=i.firstChild:i.nextSibling?(a=!1,i=i.nextSibling):(a=!0,i=i.parentNode)}return u}},{key:"setSelection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=document.createRange(),r=this.computeNodeAndOffset(e.row,e.col,t&&t.row==e.row&&t.col>e.col),i=r.node,a=r.offset,u=null,o=null;if(t&&(t.row!=e.row||t.col!=e.col)){var s=this.computeNodeAndOffset(t.row,t.col,e.row==t.row&&e.col>t.col),l=s.node,c=s.offset;u=l,o=c}u?n.setStart(u,o):n.setStart(i,a),n.setEnd(i,a);var p=window.getSelection();p.removeAllRanges(),p.addRange(n)}}},{key:"handleInputEvent",value:function(e){var t=this.getSelection();if("insertParagraph"!=e.inputType&&"insertLineBreak"!=e.inputType||!t){if(this.e.firstChild){for(var n=this.e.firstChild;n;n=n.nextSibling)if(3!=n.nodeType||"DIV"!=n.tagName){var r=document.createElement("div");this.e.insertBefore(r,n),this.e.removeChild(n),r.appendChild(n)}}else this.e.innerHTML='<div class="TMBlankLine"><br></div>';this.updateLineContentsAndFormatting()}else this.clearDirtyFlag(),this.processNewParagraph(t);t&&this.setSelection(t),this.fireChange()}},{key:"handleSelectionChangeEvent",value:function(){this.fireSelection()}},{key:"spliceLines",value:function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(u)for(var o=0;o<i;o++)this.e.removeChild(this.e.childNodes[e]);for(var s=[],l=[],c=0;c<a.length;c++)s.push(""),l.push(!0),u&&(this.e.childNodes[e]?this.e.insertBefore(document.createElement("div"),this.e.childNodes[e]):this.e.appendChild(document.createElement("div")));(t=this.lines).splice.apply(t,[e,i].concat(_n(a))),(n=this.lineTypes).splice.apply(n,[e,i].concat(s)),(r=this.lineDirty).splice.apply(r,[e,i].concat(l))}},{key:"handlePaste",value:function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");this.paste(t)}},{key:"paste",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r||(r=this.getSelection(!0)),i||(i=this.getSelection(!1)),i||(i={row:this.lines.length-1,col:this.lines[this.lines.length-1].length}),r||(r=i),r.row<i.row||r.row==i.row&&r.col<=i.col?(t=r,n=i):(t=i,n=r);var a=e.split(/(?:\r\n|\r|\n)/),u=this.lines[t.row].substr(0,t.col),o=this.lines[n.row].substr(n.col);a[0]=u.concat(a[0]);var s=a[a.length-1].length;a[a.length-1]=a[a.length-1].concat(o),this.spliceLines(t.row,1+n.row-t.row,a),i.row=t.row+a.length-1,i.col=s,this.updateFormatting(),this.setSelection(i),this.fireChange()}},{key:"computeCommonAncestor",value:function(e,t){if(!e||!t)return null;if(e==t)return e;var n,r=function(e){for(var t=[];e;)t.unshift(e),e=e.parentNode;return t},i=r(e),a=r(t);if(i[0]!=a[0])return null;for(n=0;i[n]==a[n];n++);return i[n-1]}},{key:"computeEnclosingMarkupNode",value:function(e,t,n){var r=null;if(!e)return null;if(t){if(e.row!=t.row)return null;r=this.computeCommonAncestor(e.node,t.node)}else r=e.node;if(!r)return null;for(;r!=this.e;){if(r.className&&r.className.includes(n))return r;r=r.parentNode}return null}},{key:"getCommandState",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i={};if(n||(n=this.getSelection(!1)),r||(r=this.getSelection(!0)),!n){for(var a in Dr)i[a]=null;return i}for(var u in r||(r=n),r.row<n.row||r.row==n.row&&r.col<n.col?(e=r,t=n):(e=n,t=r),t.row>e.row&&0==t.col&&(t.row--,t.col=this.lines[t.row].length),Dr)if("inline"==Dr[u].type&&(n&&n.row==r.row&&this.isInlineFormattingAllowed(n,r)?i[u]=!!this.computeEnclosingMarkupNode(n,r,Dr[u].className)||n.col==r.col&&!!this.lines[n.row].substr(0,n.col).match(Dr[u].unset.prePattern)&&!!this.lines[n.row].substr(n.col).match(Dr[u].unset.postPattern):i[u]=null),"line"==Dr[u].type)if(n){for(var o=this.lineTypes[e.row]==Dr[u].className,s=e.row;s<=t.row;s++)if(this.lineTypes[s]==Dr[u].className!=o){o=null;break}i[u]=o}else i[u]=null;return i}},{key:"setCommandState",value:function(e,t){if("inline"==Dr[e].type){var n=this.getSelection(!0),r=this.getSelection(!1);if(n||(n=r),!n)return;if(n.row!=r.row)return;if(!this.isInlineFormattingAllowed(r,n))return;var i=this.computeEnclosingMarkupNode(r,n,Dr[e].className);if(this.clearDirtyFlag(),i){this.lineDirty[r.row]=!0;var a=this.computeColumn(i,0),u=i.textContent.length,o=this.lines[r.row].substr(0,a).replace(Dr[e].unset.prePattern,""),s=this.lines[r.row].substr(a,u),l=this.lines[r.row].substr(a+u).replace(Dr[e].unset.postPattern,"");this.lines[r.row]=o.concat(s,l),n.col=o.length,r.col=n.col+u,this.updateFormatting(),this.setSelection(r,n)}else if(r.col==n.col&&this.lines[r.row].substr(0,r.col).match(Dr[e].unset.prePattern)&&this.lines[r.row].substr(r.col).match(Dr[e].unset.postPattern)){this.lineDirty[r.row]=!0;var c=this.lines[r.row].substr(0,r.col).replace(Dr[e].unset.prePattern,""),p=this.lines[r.row].substr(r.col).replace(Dr[e].unset.postPattern,"");this.lines[r.row]=c.concat(p),r.col=n.col=c.length,this.updateFormatting(),this.setSelection(r,n)}else{var h=r.col<n.col?{startCol:r.col,endCol:n.col}:{startCol:n.col,endCol:r.col},f=h.startCol,g=h.endCol,d=this.lines[r.row].substr(f,g-f).match(Pn(/^([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*).*[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)$/,{leading:1,trailing:2}));d&&(f+=d.groups.leading.length,g-=d.groups.trailing.length),r.col=f,n.col=g,this.wrapSelection(Dr[e].set.pre,Dr[e].set.post,r,n)}}else if("line"==Dr[e].type){var v=this.getSelection(!0),m=this.getSelection(!1);if(v||(v=m),!m)return;this.clearDirtyFlag();var F=v.row>m.row?m:v,y=v.row>m.row?v:m;y.row>F.row&&0==y.col&&y.row--;for(var M=F.row;M<=y.row;M++)t&&this.lineTypes[M]!=Dr[e].className&&(this.lines[M]=this.lines[M].replace(Dr[e].set.pattern,Dr[e].set.replacement.replace("$#",M-F.row+1)),this.lineDirty[M]=!0),t||this.lineTypes[M]!=Dr[e].className||(this.lines[M]=this.lines[M].replace(Dr[e].unset.pattern,Dr[e].unset.replacement),this.lineDirty[M]=!0);this.updateFormatting(),this.setSelection({row:y.row,col:this.lines[y.row].length},{row:F.row,col:0})}}},{key:"isInlineFormattingAllowed",value:function(){var e=window.getSelection();if(!e)return!1;if(e.isCollapsed&&3==e.focusNode.nodeType&&e.focusOffset==e.focusNode.nodeValue.length){var t;for(t=e.focusNode;t&&null==t.nextSibling;t=t.parentNode);if(t&&t.nextSibling.className&&t.nextSibling.className.includes("TMInlineFormatted"))return!0}var n=this.computeCommonAncestor(e.focusNode,e.anchorNode);if(!n)return!1;for(;n&&n!=this.e;){if(n.className&&(n.className.includes("TMInlineFormatted")||n.className.includes("TMBlankLine")))return!0;n=n.parentNode}return!1}},{key:"wrapSelection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n||(n=this.getSelection(!1)),r||(r=this.getSelection(!0)),n&&r&&n.row==r.row){this.lineDirty[n.row]=!0;var i=n.col<r.col?n.col:r.col,a=n.col<r.col?r.col:n.col,u=this.lines[n.row].substr(0,i).concat(e),o=a==i?"":this.lines[n.row].substr(i,a-i),s=t.concat(this.lines[n.row].substr(a));this.lines[n.row]=u.concat(o,s),r.col=u.length,n.col=r.col+o.length,this.updateFormatting(),this.setSelection(n,r)}}},{key:"toggleCommandState",value:function(e){this.lastCommandState||(this.lastCommandState=this.getCommandState()),this.setCommandState(e,!this.lastCommandState[e])}},{key:"fireChange",value:function(){if(this.textarea||this.listeners.change.length){var e=this.getContent();this.textarea&&(this.textarea.value=e);var t,n=In(this.listeners.change);try{for(n.s();!(t=n.n()).done;)(0,t.value)({content:e,linesDirty:this.linesDirty})}catch(e){n.e(e)}finally{n.f()}}}},{key:"fireSelection",value:function(){if(this.listeners.selection&&this.listeners.selection.length){var e=this.getSelection(!1),t=this.getSelection(!0),n=this.getCommandState(e,t);this.lastCommandState?Object.assign(this.lastCommandState,n):this.lastCommandState=Object.assign({},n);var r,i=In(this.listeners.selection);try{for(i.s();!(r=i.n()).done;)(0,r.value)({focus:e,anchor:t,commandState:this.lastCommandState})}catch(e){i.e(e)}finally{i.f()}}}},{key:"addEventListener",value:function(e,t){e.match(/^(?:change|input)$/i)&&this.listeners.change.push(t),e.match(/^(?:selection|selectionchange)$/i)&&this.listeners.selection.push(t)}}])&&kn(t.prototype,n),r&&kn(t,r),e}();e.Editor=Er,Object.defineProperty(e,"__esModule",{value:!0})}));